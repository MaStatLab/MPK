{
    "contents" : "\nsetwd(\"~/Dropbox/Duke/Thesis/locally_tied_stick_breaking/examples/eqapol/30apr2015/\")\nlibrary(MPK)\n\n#####################################################\n### same subject different stimulation conditions ###\n### to see changes with stimulation               ###\n#####################################################\n\ndata.1 = read.csv(\"~/Dropbox/Duke/Thesis/Flowcytometry/Equapol/EQAPOL_101_EP4_K69038GP_Unstim_02064.csv\",  header = TRUE)\ndata.2 = read.csv(\"~/Dropbox/Duke/Thesis/Flowcytometry/Equapol/EQAPOL_101_EP4_K69038GP_CEF_02072.csv\",  header = TRUE)\ndata.3 = read.csv(\"~/Dropbox/Duke/Thesis/Flowcytometry/Equapol/EQAPOL_101_EP4_K69038GP_CMVpp65_02069.csv\",  header = TRUE)\n\n\nremove.extremes <- function(data)\n{\n  for(i in 1:ncol(data))\n  {\n    idx.max = which( data[,i] == max(data[,i],na.rm = TRUE) )\n    if(length(idx.max)>1)\n    {\n      data[idx.max, ] = NA\n    }\n    idx.min = which( data[,i] == min(data[,i],na.rm = TRUE) )\n    if(length(idx.min)>1)\n    {\n      data[idx.min, ] = NA\n    }  \n  }    \n  return(na.omit(data))\n}\n\n\ndata.1 = remove.extremes(data.1)\ndata.2 = remove.extremes(data.2)\ndata.3 = remove.extremes(data.3)\n\n\n\n\n\ndata = rbind(data.1, data.2, data.3)\n\n# par(mfrow=c(1,2))\n# hist(data.1[,1], xlim = range(data[,1]), nclass = 100)\n# hist(data.2[,1], xlim = range(data[,1]), nclass = 100)\n\n\nnobs = 1000\nset.seed(1)\ndim = seq(5,10)\nY_tot = scale( as.matrix( rbind(  data.1[sample(nrow(data.1),nobs),], \n                                  data.2[sample(nrow(data.2),nobs),],\n                                  data.3[sample(nrow(data.3),nobs),] )  ) )[,dim]\n\nC =  c(rep(1,nobs),rep(2,nobs), rep(3,nobs) )\n\nidx.order = sample(nrow(Y_tot),nrow(Y_tot))\nY_tot = Y_tot[idx.order,]\nC = C[idx.order]\n\n\n\n\n\n\n\n# mcmc = list(nburn = 50000, nsave = 500, nskip = 100, ndisplay = 100)\n\nmcmc = list(nburn = 5000, nsave = 500, nskip = 10, ndisplay = 100, seed = 2)\n\nprior = list( K = 60 )\n\nans = mpk(Y_tot, C, prior = prior, mcmc = mcmc)\n\n\n# save(ans, file = \"~/Dropbox/Duke/Thesis/locally_tied_stick_breaking/examples/eqapol/30apr2015/ans.Rdata\")\n\n\nmed_log_odds = apply(ans$chain$logOdds, 2, median)\npar(mfrow=c(1,1))\nhist(med_log_odds, nclass=100)\n\nidx = sort.int(abs(med_log_odds), index.return=TRUE, decreasing=FALSE  )$ix\n\nplot(Y_tot[idx,c(1,2)], col = 1+(med_log_odds[idx]>2), pch = C[idx])\nplot(Y_tot[idx,c(2,3)], col = 1+(med_log_odds[idx]>2), pch = C[idx])\nplot(Y_tot[idx,c(3,4)], col = 1+(med_log_odds[idx]>2), pch = C[idx])\nplot(Y_tot[idx,c(4,5)], col = 1+(med_log_odds[idx]>2), pch = C[idx])\nplot(Y_tot[idx,c(5,6)], col = 1+(med_log_odds[idx]>2), pch = C[idx])\n\nit = 499\nix = sort.int(colSums(ans$chain$w[,,it]),decreasing=TRUE, index.return=TRUE)$ix\nplot(ans$chain$w[1,ix,it], ylim = c(0,max(ans$chain$w[,,it])), xlim =c (0,100))\npoints(ans$chain$w[2,ix,it], col = \"red\", pch = 2)\npoints(ans$chain$w[3,ix,it], col = \"blue\", pch = 3)\n\ntable(ans$chain$Z[500,])\ntable(ans$chain$Z[400,])\ntable(ans$chain$Z[300,])\ntable(ans$chain$Z[200,])\ntable(ans$chain$Z[100,])\n\npar(mfrow=c(1,1))\nplot.ts(ans$chain$epsilon0)\n\npar(mfrow=c(3,4))\nfor(i in 1:12)\n  hist(ans$chain$epsilon[,i], nclass=100)\n\n\nmed_tmp = matrix(NA, nrow = nrow(ans$data$Y), ncol = ans$mcmc$nsave)\nfor( it in 1: ans$mcmc$nsave)\n  med_tmp[,it] = ans$chain$epsilon[it,ans$chain$Z[it,] ]\nmed_epsilons = apply(med_tmp, 1, median)\npar(mfrow=c(1,1))\nhist(med_epsilons, nclass = 50)\n\nplotDiff(ans, dim = c(4,5))\nplotDiff(ans, type = \"shift\", dim = c(4,5))\n\n\nidx = sort.int(med_epsilons, index.return=TRUE, decreasing=FALSE  )$ix\n\nplot(Y_tot[idx,c(1,2)], col = 1+(med_epsilons[idx]>.3), pch = C[idx])\nplot(Y_tot[idx,c(2,3)], col = 1+(med_epsilons[idx]>.3), pch = C[idx])\nplot(Y_tot[idx,c(3,4)], col = 1+(med_epsilons[idx]>.3), pch = C[idx])\nplot(Y_tot[idx,c(4,5)], col = 1+(med_epsilons[idx]>.3), pch = C[idx])\nplot(Y_tot[idx,c(5,6)], col = 1+(med_epsilons[idx]>.3), pch = C[idx])\n\n######################################################\n",
    "created" : 1430416084074.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "353474325",
    "id" : "E6961039",
    "lastKnownWriteTime" : 1430599917,
    "path" : "~/Dropbox/Duke/Thesis/locally_tied_stick_breaking/code/V7/MPK/MPK/examples/example3.R",
    "project_path" : "examples/example3.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}